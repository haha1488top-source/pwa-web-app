<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0000ff">
    <title>–ö–ª—ñ–∫–µ—Ä –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="Img/pin_dead_box.png">
    <link rel="apple-touch-icon" href="Img/pin_dead_box.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="–ö–ª—ñ–∫–µ—Ä">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: Arial, sans-serif;
            padding: 20px;
            touch-action: manipulation;
            transition: background 0.5s ease;
        }

        .scene {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        .counter {
            font-size: 42px;
            color: white;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            text-align: center;
        }

        .clicker-img {
            width: 250px;
            height: 250px;
            cursor: pointer;
            transition: transform 0.1s;
            user-select: none;
            border-radius: 20px;
            margin-bottom: 15px;
        }

        .clicker-img:active {
            transform: scale(0.9);
        }

        .shop-btn {
            margin: 10px 0;
            padding: 15px 30px;
            font-size: 18px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            width: 80%;
            max-width: 280px;
        }

        .reset-btn {
            margin-top: 10px;
            padding: 12px 25px;
            font-size: 18px;
            background: #ff5722;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            width: 80%;
            max-width: 280px;
        }

        .status {
            margin-top: 15px;
            color: white;
            font-size: 16px;
            text-align: center;
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –º–∞–≥–∞–∑–∏–Ω—É */
        .shop-scene {
            background: linear-gradient(135deg, #ff6b6b 0%, #ffa726 100%);
            display: none;
        }

        .back-btn {
            margin: 10px 0;
            padding: 12px 25px;
            font-size: 18px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            width: 80%;
            max-width: 280px;
        }

        .shop-items {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }

        .shop-item {
            padding: 15px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            color: white;
            text-align: center;
            cursor: pointer;
        }

        .install-btn {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 8px 12px;
            font-size: 12px;
            background: #9C27B0;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            z-index: 1000;
            display: none;
        }
    </style>
</head>
<body>
    <!-- –ö–Ω–æ–ø–∫–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è PWA -->
    <button class="install-btn" onclick="installPWA()" id="installBtn">üì± –î–æ–¥–∞—Ç–∏</button>

    <!-- –ì–æ–ª–æ–≤–Ω–∞ —Å—Ü–µ–Ω–∞ -->
    <div class="scene main-scene">
        <div class="counter">–ö–ª—ñ–∫—ñ–≤: <span id="count">0</span></div>
        <img src="Img/pin_dead_box.png" class="clicker-img" id="clicker" alt="–ö–ª—ñ–∫–µ—Ä">
        <button class="shop-btn" onclick="openShop()">–ú–∞–≥–∞–∑–∏–Ω</button>
        <button class="reset-btn" onclick="resetCounter()">–°–∫–∏–Ω—É—Ç–∏</button>
        <div class="status" id="status">–ì—Ä–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞! –¢–∏—Å–Ω–∏ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É üëÜ</div>
    </div>

    <!-- –°—Ü–µ–Ω–∞ –º–∞–≥–∞–∑–∏–Ω—É -->
    <div class="scene shop-scene" id="shopScene">
        <div class="counter">–ú–∞–≥–∞–∑–∏–Ω</div>
        <div class="shop-items">
            <div class="shop-item" onclick="buyUpgrade('autoClick')">–ê–≤—Ç–æ–∫–ª—ñ–∫–µ—Ä - 100 –∫–ª—ñ–∫—ñ–≤</div>
            <div class="shop-item" onclick="buyUpgrade('doubleClick')">–ü–æ–¥–≤—ñ–π–Ω–∏–π –∫–ª—ñ–∫ - 200 –∫–ª—ñ–∫—ñ–≤</div>
            <div class="shop-item" onclick="buyUpgrade('megaClick')">–ú–µ–≥–∞ –∫–ª—ñ–∫ - 500 –∫–ª—ñ–∫—ñ–≤</div>
        </div>
        <button class="back-btn" onclick="closeShop()">–ù–∞–∑–∞–¥</button>
        <div class="status">–¢–≤–æ—ó –∫–ª—ñ–∫—ñ–≤: <span id="shopCount">0</span></div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ - –≤–∏–Ω–µ—Å–µ–Ω—ñ –≤ —Å–∞–º–∏–π –≤–µ—Ä—Ö
        let count = parseInt(localStorage.getItem('clickCount')) || 0;
        let upgrades = JSON.parse(localStorage.getItem('gameUpgrades')) || {
            autoClick: false,
            doubleClick: false,
            megaClick: false
        };
        let deferredPrompt;

        const counterElement = document.getElementById('count');
        const clickerImg = document.getElementById('clicker');
        const statusElement = document.getElementById('status');
        const shopScene = document.getElementById('shopScene');
        const mainScene = document.querySelector('.main-scene');
        const shopCountElement = document.getElementById('shopCount');
        const installBtn = document.getElementById('installBtn');

        function updateCounter() {
            counterElement.textContent = count;
            shopCountElement.textContent = count;
            localStorage.setItem('clickCount', count);
        }

        function resetCounter() {
            if(confirm('–°–∫–∏–Ω—É—Ç–∏ —Ä–∞—Ö—É–Ω–æ–∫?')) {
                count = 0;
                upgrades = { autoClick: false, doubleClick: false, megaClick: false };
                updateCounter();
                localStorage.setItem('gameUpgrades', JSON.stringify(upgrades));
            }
        }

        function openShop() {
            mainScene.style.display = 'none';
            shopScene.style.display = 'flex';
            document.body.classList.add('shop-scene');
        }

        function closeShop() {
            shopScene.style.display = 'none';
            mainScene.style.display = 'flex';
            document.body.classList.remove('shop-scene');
        }

        function buyUpgrade(type) {
            const costs = { autoClick: 100, doubleClick: 200, megaClick: 500 };
            if (count >= costs[type] && !upgrades[type]) {
                count -= costs[type];
                upgrades[type] = true;
                updateCounter();
                localStorage.setItem('gameUpgrades', JSON.stringify(upgrades));
                alert('–ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è –∫—É–ø–ª–µ–Ω–æ!');
            } else if (upgrades[type]) {
                alert('–í–∂–µ –∫—É–ø–ª–µ–Ω–æ!');
            } else {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–ª—ñ–∫—ñ–≤!');
            }
        }

        // –û–±—Ä–æ–±–∫–∞ –∫–ª—ñ–∫—ñ–≤ –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –ø–æ–∫—Ä–∞—â–µ–Ω—å
        function handleClick() {
            let clickValue = 1;
            if (upgrades.doubleClick) clickValue *= 2;
            if (upgrades.megaClick) clickValue *= 5;
            
            count += clickValue;
            updateCounter();
        }

        // –ê–≤—Ç–æ–∫–ª—ñ–∫–µ—Ä
        function startAutoClicker() {
            if (upgrades.autoClick) {
                setInterval(() => {
                    count += 1;
                    updateCounter();
                }, 1000);
            }
        }

        // PWA Installation
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.style.display = 'block';
        });

        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        installBtn.style.display = 'none';
                    }
                    deferredPrompt = null;
                });
            }
        }

        // –î–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ - –æ–±—Ä–æ–±–∫–∞ —Ç–∞—á—ñ–≤
        clickerImg.addEventListener('touchstart', (e) => {
            e.preventDefault();
            handleClick();
            clickerImg.style.transform = 'scale(0.9)';
        });

        clickerImg.addEventListener('touchend', (e) => {
            e.preventDefault();
            clickerImg.style.transform = 'scale(1)';
        });

        // –î–ª—è –∫–æ–º–ø'—é—Ç–µ—Ä–∞
        clickerImg.addEventListener('click', () => {
            handleClick();
            clickerImg.style.transform = 'scale(0.9)';
            setTimeout(() => {
                clickerImg.style.transform = 'scale(1)';
            }, 100);
        });

        // –ó–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        window.addEventListener('beforeunload', (e) => {
            e.preventDefault();
            e.returnValue = '–ì—Ä–∞ –±—É–¥–µ –≤—Ç—Ä–∞—á–µ–Ω–∞! –¢–æ—á–Ω–æ —Ö–æ—á–µ—à –ø—ñ—Ç–∏?';
        });

        // –ê–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
        setInterval(() => {
            localStorage.setItem('clickCount', count);
            localStorage.setItem('gameUpgrades', JSON.stringify(upgrades));
        }, 1000);

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
        updateCounter();
        startAutoClicker();
        statusElement.textContent = '–ì—Ä–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞! –¢–∏—Å–Ω–∏ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É üëÜ';

        // Service Worker –¥–ª—è –æ—Ñ–ª–∞–π–Ω —Ä–æ–±–æ—Ç–∏
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('./service-worker.js');
            });
        }
    </script>
</body>
</html>
